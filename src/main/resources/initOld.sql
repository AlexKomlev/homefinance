DROP TABLE TRANSACTIONS;
DROP TABLE TRANSACTION_TYPES;
DROP TABLE ACCOUNTS;
DROP TABLE ACCOUNT_TYPES;

CREATE TABLE ACCOUNT_TYPES(
	ID INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL PRIMARY KEY,
	NAME VARCHAR(64) NOT NULL,
	DESCRIPTION VARCHAR(255) NOT NULL,
	UNIQUE(NAME)
	);

CREATE TABLE ACCOUNTS(
	ID INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL PRIMARY KEY,
	NAME VARCHAR(64) NOT NULL,
	TYPE INTEGER NOT NULL,
	CREDIT_RATE INTEGER,
	LIMIT INTEGER,
  DESCRIPTION VARCHAR(64) NOT NULL,
  FOREIGN KEY (TYPE) REFERENCES ACCOUNT_TYPES (ID),
	UNIQUE(NAME)
	);

CREATE TABLE TRANSACTION_TYPES(
  ID INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL PRIMARY KEY,
  TRANSACTION_TYPE_RANK INTEGER,
  TRANSACTION_TYPE_NAME VARCHAR(64) NOT NULL,
  TRANSACTION_DIRECTION VARCHAR(1) NOT NULL,
  TRANSACTION_TYPE_DESCRIPTION VARCHAR(255) NOT NULL,
  UNIQUE(TRANSACTION_TYPE_NAME),
  CHECK (TRANSACTION_DIRECTION IN ('I','O','T'))
);

CREATE TABLE TRANSACTIONS(
  ID INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL PRIMARY KEY,
  TRANSACTION_DELIVER_ACCOUNT INTEGER,
  TRANSACTION_RECEIVE_ACCOUNT INTEGER,
  TRANSACTION_TYPE INTEGER NOT NULL,
  TRANSACTION_DATE DATE NOT NULL,
  TRANSACTION_VALUE INTEGER NOT NULL,
  TRANSACTION_DESCRIPTION VARCHAR(255),
  FOREIGN KEY (TRANSACTION_TYPE) REFERENCES TRANSACTION_TYPES (ID),
  FOREIGN KEY (TRANSACTION_DELIVER_ACCOUNT) REFERENCES ACCOUNTS (ID),
  FOREIGN KEY (TRANSACTION_RECEIVE_ACCOUNT) REFERENCES ACCOUNTS (ID),
  CHECK (TRANSACTION_DELIVER_ACCOUNT IS NOT NULL OR TRANSACTION_RECEIVE_ACCOUNT IS NOT NULL)
);

INSERT INTO ACCOUNT_TYPES VALUES(1,'cash', 'Наличные');
INSERT INTO ACCOUNT_TYPES VALUES(2,'debit', 'Дебетовый счет');
INSERT INTO ACCOUNT_TYPES VALUES(3,'credit', 'Кредитный счет');

INSERT INTO ACCOUNTS VALUES(1, 'cash', 1, null, null, 'Наличные');
INSERT INTO ACCOUNTS VALUES(2, 'citi_debit', 2, null, null, 'Дебетовая карта Сити');
INSERT INTO ACCOUNTS VALUES(3, 'citi_credit', 3, 18, 200000, 'Кредитная карта Сити');

INSERT INTO TRANSACTION_TYPES VALUES(1, 1,'transfer', 'T', 'Перевод');
INSERT INTO TRANSACTION_TYPES VALUES(2, 1,'payment', 'I', 'Зачисление');
INSERT INTO TRANSACTION_TYPES VALUES(3, 2,'balance', 'I', 'Баланс');

INSERT INTO TRANSACTION_TYPES VALUES(4, 1,'rent', 'O', 'Квартплата');
INSERT INTO TRANSACTION_TYPES VALUES(5, 1,'mobile', 'O', 'Мобильная связь');
INSERT INTO TRANSACTION_TYPES VALUES(6, 1,'inet', 'O', 'Интернет');
INSERT INTO TRANSACTION_TYPES VALUES(7, 1,'food', 'O', 'Питание');
INSERT INTO TRANSACTION_TYPES VALUES(8, 1,'transport', 'O', 'Транспорт');
INSERT INTO TRANSACTION_TYPES VALUES(9, 1,'childcare', 'O', 'Детские товары');
INSERT INTO TRANSACTION_TYPES VALUES(10, 1,'cosmetics', 'O', 'Косметика');
INSERT INTO TRANSACTION_TYPES VALUES(11, 1,'drugstore', 'O', 'Аптека');
INSERT INTO TRANSACTION_TYPES VALUES(12, 1,'home', 'O', 'Бытовые товары');
INSERT INTO TRANSACTION_TYPES VALUES(13, 1,'haircut', 'O', 'Стрижка');
INSERT INTO TRANSACTION_TYPES VALUES(14, 1,'lenses', 'O', 'Линзы');
INSERT INTO TRANSACTION_TYPES VALUES(15, 1,'lunch', 'O', 'Питание на работе');
INSERT INTO TRANSACTION_TYPES VALUES(16, 1,'dainty', 'O', 'Лакомства');
INSERT INTO TRANSACTION_TYPES VALUES(17, 1,'credit', 'O', 'Кредит');
INSERT INTO TRANSACTION_TYPES VALUES(18, 1,'other', 'O', 'Прочее');

INSERT INTO TRANSACTIONS VALUES(1, null, 2, 2, now, 100000, 'ЗП');
INSERT INTO TRANSACTIONS VALUES(2, 2, null, 8, now, 1000, null);
INSERT INTO TRANSACTIONS VALUES(3, 2, null, 7, now, 5000, null);
INSERT INTO TRANSACTIONS VALUES(4, 2, null, 17, now, 10000, null);
