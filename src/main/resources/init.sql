CREATE TABLE ACCOUNT_TYPES(
	ID INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL PRIMARY KEY,
	ACCOUNT_TYPE_NAME VARCHAR(64) NOT NULL,
	ACCOUNT_TYPE_DESCRIPTION VARCHAR(255) NOT NULL,
	UNIQUE(ACCOUNT_TYPE_NAME)
	);

CREATE TABLE ACCOUNTS(
	ID INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL PRIMARY KEY,
	ACCOUNT_NAME VARCHAR(64) NOT NULL,
	ACCOUNT_TYPE INTEGER NOT NULL,
	ACCOUNT_DEBIT_RATE INTEGER,
	ACCOUNT_DEBIT_LIMIT INTEGER,
  ACCOUNT_DESCRIPTION VARCHAR(64) NOT NULL,
  FOREIGN KEY (ACCOUNT_TYPE) REFERENCES ACCOUNT_TYPES (ID),
	UNIQUE(ACCOUNT_NAME)
	);

CREATE TABLE TRANSACTION_TYPES(
  ID INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL PRIMARY KEY,
  TRANSACTION_TYPE_NAME VARCHAR(64) NOT NULL,
  TRANSACTION_DIRECTION VARCHAR(1) NOT NULL,
  TRANSACTION_TYPE_DESCRIPTION VARCHAR(255) NOT NULL,
  UNIQUE(TRANSACTION_TYPE_NAME),
  CHECK (TRANSACTION_DIRECTION IN ('R','D','T'))
);

CREATE TABLE TRANSACTIONS(
  ID INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL PRIMARY KEY,
  TRANSACTION_DELIVER_ACCOUNT INTEGER,
  TRANSACTION_RECEIVE_ACCOUNT INTEGER,
  TRANSACTION_TYPE INTEGER NOT NULL,
  TRANSACTION_DATE DATE NOT NULL,
  TRANSACTION_VALUE INTEGER NOT NULL,
  TRANSACTION_DESCRIPTION VARCHAR(255),
  FOREIGN KEY (TRANSACTION_TYPE) REFERENCES TRANSACTION_TYPES (ID),
  FOREIGN KEY (TRANSACTION_DELIVER_ACCOUNT) REFERENCES ACCOUNTS (ID),
  FOREIGN KEY (TRANSACTION_RECEIVE_ACCOUNT) REFERENCES ACCOUNTS (ID),
  CHECK (TRANSACTION_DELIVER_ACCOUNT IS NOT NULL OR TRANSACTION_RECEIVE_ACCOUNT IS NOT NULL)
);

INSERT INTO ACCOUNT_TYPES VALUES(1,'cash', 'Наличные');
INSERT INTO ACCOUNT_TYPES VALUES(2,'debit', 'Дебетовый счет');
INSERT INTO ACCOUNT_TYPES VALUES(3,'credit', 'Кредитный счет');

INSERT INTO ACCOUNTS VALUES(1, 'cash', 1, null, null, 'Наличные');
INSERT INTO ACCOUNTS VALUES(2, 'citi_debit', 2, null, null, 'Дебетовая карта Сити');
INSERT INTO ACCOUNTS VALUES(3, 'citi_credit', 3, 18, 200000, 'Кредитная карта Сити');